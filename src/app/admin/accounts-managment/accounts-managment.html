@let accounts = accountList();
@let banned = bannedList();

@if (!isAdmin()) {
  <div class="alert error">No tienes permisos para ver esta sección.</div>
} @else {
  <section class="admin-accounts">
    <header class="page-header">
      <div>
        <h2>Gestión de cuentas</h2>
        <p class="muted">Listado de usuarios (sin admins) y acciones de ban.</p>
      </div>
      <button type="button" class="btn ghost" (click)="reload()" [disabled]="accounts.loading || banned.loading">Recargar</button>
    </header>

    @if (accounts.loading || banned.loading) {
      <p>Cargando...</p>
    } @else if (accounts.error || banned.error) {
      <div class="alert error">{{ accounts.error || banned.error }}</div>
    } @else {
      <section class="card">
        <h3>Usuarios activos</h3>
        @if (!accounts.data.length) {
          <p class="muted">Sin usuarios activos.</p>
        } @else {
          <ul class="list">
            @for (user of accounts.data; track user.username) {
              <li>
                <div>
                  <strong>{{ user.username }}</strong>
                  <div class="muted">Rol: {{ user.role }}</div>
                </div>
                <div class="actions">
                  <button type="button" class="btn danger" (click)="ban(user.username)">Banear</button>
                </div>
              </li>
            }
          </ul>
        }
      </section>

      <section class="card">
        <h3>Usuarios baneados</h3>
        @if (!banned.data.length) {
          <p class="muted">No hay usuarios baneados.</p>
        } @else {
          <ul class="list">
            @for (user of banned.data; track user.username) {
              <li>
                <div>
                  <strong>{{ user.username }}</strong>
                  <div class="muted">Rol: {{ user.role }}</div>
                </div>
                <div class="actions">
                  <button type="button" class="btn" (click)="unban(user.username)">Desbanear</button>
                  <button type="button" class="btn danger" (click)="removeBanned(user.username)">Eliminar</button>
                </div>
              </li>
            }
          </ul>
        }
      </section>
    }
  </section>
}
