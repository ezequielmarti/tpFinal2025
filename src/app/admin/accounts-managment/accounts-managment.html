@let state = svc.state();

@if(!isAdmin()){
  <div class="alert error">No tienes permisos para ver esta seccion.</div>
}@else{
  <section class="admin-accounts">
    <header class="page-header">
      <div>
        <h2>Gestion de cuentas</h2>
        <p class="muted">Listado de usuarios (sin admins) y acciones de ban.</p>
      </div>
      <button type="button" class="btn ghost" (click)="svc.load()" [disabled]="state.loading">Recargar</button>
    </header>

    @if(state.loading){
      <p>Cargando...</p>
    }@else if(state.error){
      <div class="alert error">{{ state.error }}</div>
    }@else{
      <section class="card">
        <h3>Usuarios activos</h3>
        @if(!state.users.length){
          <p class="muted">Sin usuarios activos.</p>
        }@else{
          <ul class="list">
            @for (user of state.users; track user.id) {
              <li>
                <div>
                  <strong>{{ user.username }}</strong>
                  <div class="muted">{{ user.email }} · Rol: {{ user.role }}</div>
                </div>
                <div class="actions">
                  <button type="button" class="btn danger" (click)="svc.ban(user.id)">Banear</button>
                </div>
              </li>
            }
          </ul>
        }
      </section>

      <section class="card">
        <h3>Usuarios baneados</h3>
        @if(!state.banned.length){
          <p class="muted">No hay usuarios baneados.</p>
        }@else{
          <ul class="list">
            @for (user of state.banned; track user.id) {
              <li>
                <div>
                  <strong>{{ user.username }}</strong>
                  <div class="muted">{{ user.email }} · Rol: {{ user.role }}</div>
                </div>
                <div class="actions">
                  <button type="button" class="btn" (click)="svc.unban(user.id)">Desbanear</button>
                  <button type="button" class="btn ghost" (click)="svc.remove(user.id)">Eliminar</button>
                </div>
              </li>
            }
          </ul>
        }
      </section>
    }
  </section>
}
