@let auth = authState();
@let state = state();
@let active = activeProducts();
@let blocked = blockedProducts();

@if (!isAdmin()) {
  <div class="alert error">No tienes permisos para ver esta sección.</div>
} @else {
  <section class="admin-products">
    <header class="page-header">
      <div>
        <h2>Gestión de productos</h2>
        <p class="muted">Lista completa y acciones de bloqueo/habilitación.</p>
      </div>
      <button type="button" class="btn ghost" (click)="reload()" [disabled]="state.loading">Recargar</button>
    </header>

    @if (state.loading) {
      <p>Cargando productos...</p>
    } @else if (state.error) {
      <div class="alert error">{{ state.error }}</div>
    } @else {
      <section class="card">
        <h3>Productos activos</h3>
        @if (!active.length) {
          <p class="muted">Sin productos activos.</p>
        } @else {
          <ul class="list">
            @for (prod of active; track prod.id) {
              <li>
                <div>
                  <strong>{{ prod.title }}</strong>
                  <div class="muted">ID: {{ prod.id }} · Dueño: {{ prod.ownerId || 'n/d' }}</div>
                </div>
                <div class="actions">
                  <button type="button" class="btn danger" (click)="disableProduct(prod.id)">Deshabilitar</button>
                  <button type="button" class="btn ghost" (click)="banOwner(prod.ownerId)">Banear cuenta</button>
                </div>
              </li>
            }
          </ul>
        }
      </section>

      <section class="card">
        <h3>Productos bloqueados</h3>
        @if (!blocked.length) {
          <p class="muted">No hay productos bloqueados.</p>
        } @else {
          <ul class="list">
            @for (prod of blocked; track prod.id) {
              <li>
                <div>
                  <strong>{{ prod.title }}</strong>
                  <div class="muted">ID: {{ prod.id }} · Dueño: {{ prod.ownerId || 'n/d' }}</div>
                </div>
                <div class="actions">
                  <button type="button" class="btn" (click)="enableProduct(prod.id)">Habilitar</button>
                  <button type="button" class="btn ghost" (click)="removeProduct(prod.id)">Eliminar</button>
                </div>
              </li>
            }
          </ul>
        }
      </section>
    }
  </section>
}
