@let product = productState();

<section class="product-update">
  @if (product.loading) {
    <p>Cargando producto...</p>
  } @else if (product.error) {
    <div class="alert error">Error: {{ product.error }}</div>
  } @else if (!product.data) {
    <p class="muted">No hay producto seleccionado.</p>
  } @else {
    <header class="page-header">
      <div>
        <h2>Editar producto</h2>
        <p class="muted">{{ product.data.title }}</p>
      </div>
    </header>

    <form class="card" [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>
      <h3>Datos principales</h3>
      <div class="grid">
        <label>
          <span>Título</span>
          <input type="text" formControlName="title" />
        </label>
        <label>
          <span>Precio</span>
          <input type="number" formControlName="price" min="0" step="0.01" />
        </label>
        <label>
          <span>Stock</span>
          <input type="number" formControlName="stock" min="0" />
        </label>
        <label>
          <span>Descuento %</span>
          <input type="number" formControlName="discount" min="0" max="100" />
        </label>
      </div>

      <label>
        <span>Descripción</span>
        <textarea rows="3" formControlName="description"></textarea>
      </label>
      <div class="inline">
        <label>
          <span>Categoría</span>
          <select formControlName="category" required>
            <option value="" disabled selected hidden>Selecciona una categoria</option>
            @for (cat of categories; track cat) {
              <option [value]="cat">{{ cat }}</option>
            }
          </select>
        </label>
        <label>
          <span>Marca</span>
          <input type="text" formControlName="brand" />
        </label>
      </div>
      <div class="tags-field">
        <span>Tags</span>
        <div class="tags-grid" style="display:grid; grid-template-columns: repeat(10, minmax(0, 1fr)); gap:0.5rem 0.75rem; align-items:start;">
          @for (tag of tagsList; track tag) {
            <label class="tag-option" style="display:flex; align-items:center; gap:0.35rem; font-size:0.9rem;">
              <input type="checkbox"
                     [checked]="form.controls.tags.value.includes(tag)"
                     (change)="onTagToggle(tag, $event.target.checked)" />
              <span>{{ tag }}</span>
            </label>
          }
        </div>
      </div>
      <div class="form-actions">
        <button class="btn primary" type="submit">Guardar</button>
        <button class="btn ghost" type="button" (click)="onCancel()">Cancelar</button>
      </div>
    </form>
  }
</section>
