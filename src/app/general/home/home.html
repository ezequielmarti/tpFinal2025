@let featuredView = featuredState();
@let catalogView = catalogState();

@if (featuredView.error && catalogView.error) {
  <div class="alert error">No pudimos cargar los productos.</div>
} @else {
  <header class="hero">
    <div class="hero__copy">
      <p class="eyebrow">Bienvenido</p>
      <h1>Encontrá los mejores productos</h1>
      <p class="muted">Explorá destacados o buscá por categoría.</p>
    </div>
  </header>

  <section class="quick-links">
    <h3>Explorá categorías</h3>
    <div class="card-row">
      <a class="chip" routerLink="/category/all">Todos</a>
      <a class="chip" routerLink="/category/electronic">Electrónica</a>
      <a class="chip" routerLink="/category/sports">Deportes</a>
      <a class="chip" routerLink="/category/home-appliance">Hogar</a>
      <a class="chip" routerLink="/category/fashion">Moda</a>
    </div>
  </section>

  <section class="featured">
    <h2>Destacados</h2>
    @if (featuredView.loading) {
      <p>Cargando destacados...</p>
    } @else if (featuredView.error) {
      <div class="alert error">{{ featuredView.error }}</div>
    } @else if (!featuredView.data.length) {
      <p class="muted">Sin productos destacados.</p>
    } @else {
      <div class="product-grid">
        @for (item of featuredView.data; track item.id) {
          <a class="card product" [routerLink]="['/product', item.id]">
            <img
              [ngSrc]="item.thumbnail || item.images?.[0] || fallbackImage"
              width="320"
              height="240"
              [alt]="item.title"
              loading="lazy"
            />
            <h3>{{ item.title }}</h3>
            <p class="muted">{{ item.description }}</p>
            <div class="meta product-meta">
              @if (item.discountPercentage > 0) {
                <div>
                  <div class="price-original">${{ item.price }}</div>
                  <div class="price-final">${{ item.price - (item.price * item.discountPercentage / 100) }}</div>
                </div>
                <span class="badge success">{{ item.discountPercentage }}% OFF</span>
              } @else {
                <strong class="price-final">${{ item.price }}</strong>
              }
            </div>
          </a>
        }
      </div>
    }
  </section>

  <section class="catalog">
    <h2>Todos los productos</h2>
    @if (catalogView.loading) {
      <p>Cargando productos...</p>
    } @else if (catalogView.error) {
      <div class="alert error">{{ catalogView.error }}</div>
    } @else if (!catalogItems().length) {
      <p class="muted">Aún no hay productos en el listado.</p>
    } @else {
      <div class="product-grid">
        @for (item of catalogItems(); track item.id) {
          <a class="card product" [routerLink]="['/product', item.id]">
            <img
              [ngSrc]="item.thumbnail || item.images?.[0] || fallbackImage"
              width="320"
              height="240"
              [alt]="item.title"
              loading="lazy"
            />
            <h3>{{ item.title }}</h3>
            <p class="muted">{{ item.description }}</p>
            <div class="meta product-meta">
              @if (item.discountPercentage > 0) {
                <div>
                  <div class="price-original">${{ item.price }}</div>
                  <div class="price-final">${{ item.price - (item.price * item.discountPercentage / 100) }}</div>
                </div>
                <span class="badge success">{{ item.discountPercentage }}% OFF</span>
              } @else {
                <strong class="price-final">${{ item.price }}</strong>
              }
            </div>
          </a>
        }
      </div>
    }
  </section>
}
