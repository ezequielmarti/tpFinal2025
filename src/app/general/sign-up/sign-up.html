<section class="sign-up">
  @if (!accountType()) {
    <header class="page-header">
      <h2>Crear cuenta</h2>
      <p class="muted">Elegí el tipo de cuenta para empezar.</p>
    </header>
    <div class="card grid">
      <button type="button" class="btn" (click)="onSelectAccount(Role.User)">Usuario</button>
      <button type="button" class="btn" (click)="onSelectAccount(Role.Business)">Negocio</button>
      <button type="button" class="btn ghost" (click)="onSelectAccount(Role.Admin)">Admin</button>
    </div>
  } @else {
    <form class="card" [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>
      <header class="form-header">
        <h3>Datos de acceso</h3>
        <p class="muted">Completa los datos para crear tu cuenta {{ accountGroup() }}.</p>
      </header>

      <div class="grid">
        <label>
          <span>Email</span>
          <input type="email" formControlName="email" placeholder="email@ejemplo.com" />
          @if (email.dirty || email.touched) {
            @if (email.hasError('required')) { <span class="field-error">El email es requerido.</span> }
            @else if (email.hasError('email')) { <span class="field-error">Ingresa un email válido.</span> }
          }
        </label>

        <label>
          <span>Usuario</span>
          <input type="text" formControlName="username" placeholder="nombre de usuario" />
          @if (username.dirty || username.touched) {
            @if (username.hasError('required')) { <span class="field-error">El usuario es requerido.</span> }
            @else if (username.hasError('minlength')) { <span class="field-error">Usa al menos 3 caracteres.</span> }
          }
        </label>

        <label>
          <span>Contraseña</span>
          <input type="password" formControlName="password" placeholder="********" />
          @if (password.dirty || password.touched) {
            @if (password.hasError('required')) { <span class="field-error">La contraseña es requerida.</span> }
            @else if (password.hasError('minlength')) { <span class="field-error">Mínimo 8 caracteres.</span> }
          }
        </label>
      </div>

      @switch (accountGroup()) {
        @case ('user') {
          <section aria-label="Datos de usuario">
            <h4>Datos de usuario</h4>
            <div class="grid">
              <label>
                <span>Nombre</span>
                <input type="text" formControlName="firstname" placeholder="Nombre" />
                @if (firstname.dirty || firstname.touched) {
                  @if (firstname.hasError('required')) { <span class="field-error">El nombre es requerido.</span> }
                }
              </label>

              <label>
                <span>Apellido</span>
                <input type="text" formControlName="lastname" placeholder="Apellido" />
                @if (lastname.dirty || lastname.touched) {
                  @if (lastname.hasError('required')) { <span class="field-error">El apellido es requerido.</span> }
                }
              </label>

              <label>
                <span>Fecha de nacimiento (opcional)</span>
                <input type="date" formControlName="birth" />
              </label>

              <label>
                <span>Teléfono (opcional)</span>
                <input type="tel" formControlName="phone" placeholder="+54..." />
              </label>
            </div>
          </section>
        }
        @case ('business') {
          <section aria-label="Datos de negocio">
            <h4>Datos de negocio</h4>
            <div class="grid">
              <label>
                <span>Nombre público</span>
                <input type="text" formControlName="title" placeholder="Mi tienda" />
                @if (title.dirty || title.touched) {
                  @if (title.hasError('required')) { <span class="field-error">El nombre del negocio es requerido.</span> }
                }
              </label>

              <label>
                <span>Bio (opcional)</span>
                <textarea rows="2" formControlName="bio" placeholder="Descripción corta"></textarea>
              </label>

              <label>
                <span>Teléfono</span>
                <input type="tel" formControlName="phone" placeholder="+54..." />
                @if (phone.dirty || phone.touched) {
                  @if (phone.hasError('required')) { <span class="field-error">El teléfono es requerido.</span> }
                }
              </label>

              <label>
                <span>Correo de contacto (opcional)</span>
                <input type="email" formControlName="contactEmail" placeholder="contacto@tienda.com" />
              </label>
            </div>
          </section>
        }
        @case ('admin') {
          <section aria-label="Datos de administrador">
            <h4>Datos de administrador</h4>
            <div class="grid">
              <label>
                <span>Nombre público</span>
                <input type="text" formControlName="publicName" placeholder="Admin" />
                @if (publicName.dirty || publicName.touched) {
                  @if (publicName.hasError('required')) { <span class="field-error">El nombre público es requerido.</span> }
                }
              </label>
            </div>
          </section>
        }
      }

      @if (accountSignal.creationState().error) {
        <p class="field-error" role="alert">{{ accountSignal.creationState().error }}</p>
      }

      <div class="form-actions">
        <button type="submit" class="btn primary" [disabled]="isBusy()">Crear cuenta</button>
        <button type="button" class="btn ghost" (click)="onChangeAccountType()" [disabled]="isBusy()">Elegir otro tipo</button>
      </div>
    </form>
  }
</section>
